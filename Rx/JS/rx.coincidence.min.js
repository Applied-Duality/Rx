(function(t,e){var n="object"==typeof exports&&exports&&("object"==typeof t&&t&&t==t.global&&(window=t),exports);"function"==typeof define&&define.amd?define(["rx","exports"],function(n,r){return t.Rx=e(t,r,n),t.Rx}):"object"==typeof module&&module&&module.exports==n?module.exports=e(t,module.exports,require("./rx")):t.Rx=e(t,{},t.Rx)})(this,function(t,e,n,r){function i(){}function o(t,e){return t===e}function s(t){var e,n;if(false&t)return 2===t;for(e=Math.sqrt(t),n=3;e>=n;){if(0===t%n)return!1;n+=2}return!0}function u(t){var e,n,r;for(e=0;x.length>e;++e)if(n=x[e],n>=t)return n;for(r=1|t;x[x.length-1]>r;){if(s(r))return r;r+=2}return t}function c(){return{key:null,value:null,next:0,hashCode:0}}function h(t,e){return t.groupJoin(this,e,function(){return w()},function(t,e){return e})}function a(t){var e=this;return new g(function(n){var r=new m,i=new p,o=new d(i);return n.onNext(E(r,o)),i.add(e.subscribe(function(t){r.onNext(t)},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),i.add(t.subscribe(function(){r.onCompleted(),r=new m,n.onNext(E(r,o))},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),o})}function l(t){var e=this;return new g(function(n){var o,s=new v,u=new p(s),c=new d(u),h=new m;return n.onNext(E(h,c)),u.add(e.subscribe(function(t){h.onNext(t)},function(t){h.onError(t),n.onError(t)},function(){h.onCompleted(),n.onCompleted()})),o=function(){var e,u;try{u=t()}catch(a){return n.onError(a),r}e=new b,s.disposable(e),e.disposable(u.take(1).subscribe(i,function(t){h.onError(t),n.onError(t)},function(){h.onCompleted(),h=new m,n.onNext(E(h,c)),o()}))},o(),c})}var f=n.Observable,p=n.CompositeDisposable,d=n.RefCountDisposable,b=n.SingleAssignmentDisposable,v=n.SerialDisposable,m=n.Subject,y=f.prototype,w=f.empty,g=n.Internals.AnonymousObservable,E=(n.Observer.create,n.Internals.addRef),x=[1,3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143,4194301,8388593,16777213,33554393,67108859,134217689,268435399,536870909,1073741789,2147483647],C="no such key",A="duplicate key",_=function(){var t=0;return function(e){var n;if(e===r)throw Error(C);return e.getHashCode!==r?e.getHashCode():(n=17*t++,e.getHashCode=function(){return n},n)}}(),D=function(t,e){this._initialize(t),this.comparer=e||o,this.freeCount=0,this.size=0,this.freeList=-1};return D.prototype._initialize=function(t){var e,n=u(t);for(this.buckets=Array(n),this.entries=Array(n),e=0;n>e;e++)this.buckets[e]=-1,this.entries[e]=c();this.freeList=-1},D.prototype.count=function(){return this.size},D.prototype.add=function(t,e){return this._insert(t,e,!0)},D.prototype._insert=function(t,e,n){this.buckets===r&&this._initialize(0);for(var i=2147483647&_(t),o=i%this.buckets.length,s=this.buckets[o];s>=0;s=this.entries[s].next)if(this.entries[s].hashCode===i&&this.comparer(this.entries[s].key,t)){if(n)throw A;return this.entries[s].value=e,r}if(this.freeCount>0){var u=this.freeList;this.freeList=this.entries[u].next,--this.freeCount}else this.size===this.entries.length&&(this._resize(),o=i%this.buckets.length),u=this.size,++this.size;this.entries[u].hashCode=i,this.entries[u].next=this.buckets[o],this.entries[u].key=t,this.entries[u].value=e,this.buckets[o]=u},D.prototype._resize=function(){var t=u(2*this.size),e=Array(t);for(r=0;e.length>r;++r)e[r]=-1;var n=Array(t);for(r=0;this.size>r;++r)n[r]=this.entries[r];for(var r=this.size;t>r;++r)n[r]=c();for(var i=0;this.size>i;++i){var o=n[i].hashCode%t;n[i].next=e[o],e[o]=i}this.buckets=e,this.entries=n},D.prototype.remove=function(t){if(this.buckets!==r)for(var e=2147483647&_(t),n=e%this.buckets.length,i=-1,o=this.buckets[n];o>=0;o=this.entries[o].next){if(this.entries[o].hashCode===e&&this.comparer(this.entries[o].key,t))return 0>i?this.buckets[n]=this.entries[o].next:this.entries[i].next=this.entries[o].next,this.entries[o].hashCode=-1,this.entries[o].next=this.freeList,this.entries[o].key=null,this.entries[o].value=null,this.freeList=o,++this.freeCount,!0;i=o}return!1},D.prototype.clear=function(){var t,e;if(!(0>=this.size)){for(t=0,e=this.buckets.length;e>t;++t)this.buckets[t]=-1;for(t=0;this.size>t;++t)this.entries[t]=c();this.freeList=-1,this.size=0}},D.prototype._findEntry=function(t){if(this.buckets!==r)for(var e=2147483647&_(t),n=this.buckets[e%this.buckets.length];n>=0;n=this.entries[n].next)if(this.entries[n].hashCode===e&&this.comparer(this.entries[n].key,t))return n;return-1},D.prototype.count=function(){return this.size-this.freeCount},D.prototype.tryGetEntry=function(t){var e=this._findEntry(t);return e>=0?{key:this.entries[e].key,value:this.entries[e].value}:r},D.prototype.getValues=function(){var t=0,e=[];if(this.entries!==r)for(var n=0;this.size>n;n++)this.entries[n].hashCode>=0&&(e[t++]=this.entries[n].value);return e},D.prototype.get=function(t){var e=this._findEntry(t);if(e>=0)return this.entries[e].value;throw Error(C)},D.prototype.set=function(t,e){this._insert(t,e,!1)},D.prototype.containskey=function(t){return this._findEntry(t)>=0},y.join=function(t,e,n,o){var s=this;return new g(function(u){var c=new p,h=!1,a=0,l=new D,f=!1,d=0,v=new D;return c.add(s.subscribe(function(t){var n,s,f,p,d=a++,m=new b;l.add(d,t),c.add(m),s=function(){return l.remove(d)&&0===l.count()&&h&&u.onCompleted(),c.remove(m)};try{n=e(t)}catch(y){return u.onError(y),r}m.disposable(n.take(1).subscribe(i,u.onError.bind(u),function(){s()})),p=v.getValues();for(var w=0;p.length>w;w++){try{f=o(t,p[w])}catch(g){return u.onError(g),r}u.onNext(f)}},u.onError.bind(u),function(){h=!0,(f||0===l.count())&&u.onCompleted()})),c.add(t.subscribe(function(t){var e,s,h,a,p=d++,m=new b;v.add(p,t),c.add(m),s=function(){return v.remove(p)&&0===v.count()&&f&&u.onCompleted(),c.remove(m)};try{e=n(t)}catch(y){return u.onError(y),r}m.disposable(e.take(1).subscribe(i,u.onError.bind(u),function(){s()})),a=l.getValues();for(var w=0;a.length>w;w++){try{h=o(a[w],t)}catch(y){return u.onError(y),r}u.onNext(h)}},u.onError.bind(u),function(){f=!0,(h||0===v.count())&&u.onCompleted()})),c})},y.groupJoin=function(t,e,n,o){var s=this;return new g(function(u){var c=new p,h=new d(c),a=0,l=new D,f=0,v=new D;return c.add(s.subscribe(function(t){var n,s,f,p,d,y,w=a++,g=new m;l.add(w,g);try{d=o(t,E(g,h))}catch(x){for(p=l.getValues(),f=0;p.length>f;f++)p[f].onError(x);return u.onError(x),r}for(u.onNext(d),y=v.getValues(),f=0;y.length>f;f++)g.onNext(y[f]);var C=new b;c.add(C),s=function(){l.remove(w)&&g.onCompleted(),c.remove(C)};try{n=e(t)}catch(x){for(p=l.getValues(),f=0;p.length>f;f++)p[f].onError(x);return u.onError(x),r}C.disposable(n.take(1).subscribe(i,function(t){p=l.getValues();for(var e=0,n=p.length;n>e;e++)p[e].onError(t);u.onError(t)},function(){s()}))},function(t){var e,n;for(n=l.getValues(),e=0;n.length>e;e++)n[e].onError(t);u.onError(t)},u.onCompleted.bind(u))),c.add(t.subscribe(function(t){var e,o,s,h=f++;v.add(h,t);var a=new b;c.add(a);var p=function(){v.remove(h),c.remove(a)};try{e=n(t)}catch(d){for(s=l.getValues(),o=0;s.length>o;o++)s[o].onError(d);return u.onError(d),r}for(a.disposable(e.take(1).subscribe(i,function(t){s=l.getValues();for(var e=0;s.length>e;e++)s[e].onError(t);u.onError(t)},function(){p()})),s=l.getValues(),o=0;s.length>o;o++)s[o].onNext(t)},function(t){var e,n;for(n=l.getValues(),e=0;n.length>e;e++)n[e].onError(t);u.onError(t)})),h})},y.buffer=function(t,e){return 1===arguments.length&&"function"!=typeof arguments[0]?a.call(this,t).selectMany(function(t){return t.toArray()}):"function"==typeof t?l(t).selectMany(function(t){return t.toArray()}):h(this,t,e).selectMany(function(t){return t.toArray()})},y.window=function(t,e){return 1===arguments.length&&"function"!=typeof arguments[0]?a.call(this,t):"function"==typeof t?l.call(this,t):h.call(this,t,e)},n});